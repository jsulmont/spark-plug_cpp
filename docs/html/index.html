<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Sparkplug B C++ Library: Sparkplug B C++ Library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Sparkplug B C++ Library<span id="projectnumber">&#160;1.0.0</span>
   </div>
   <div id="projectbrief">Modern C++23 implementation of Eclipse Sparkplug B 2.2 specification</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('index.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Sparkplug B C++ Library </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README"></a></p>
<p>A modern C++23 implementation of the Eclipse Sparkplug B 2.2 specification for Industrial IoT.</p>
<p><b><a href="https://jsulmont.github.io/spark-plug_cpp/html/">ðŸ“š API Documentation</a></b> | <a href="https://www.eclipse.org/tahu/spec/Sparkplug%20Topic%20Namespace%20and%20State%20ManagementV2.2-with%20appendix%20B%20format%20-%20Eclipse.pdf">Sparkplug Specification</a></p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md1"></a>
Features</h1>
<ul>
<li><b>Full Sparkplug B 2.2 Compliance</b> - Implements the complete specification</li>
<li><b>Modern C++23</b> - Uses latest C++ features (std::expected, ranges, modules-ready)</li>
<li><b>Type Safe</b> - Leverages strong typing and compile-time checks</li>
<li><b>Easy Integration</b> - Simple Publisher/Subscriber API</li>
<li><b>Tested</b> - Comprehensive compliance test suite included</li>
<li><b>Cross Platform</b> - Works on macOS and Linux</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md2"></a>
Documentation</h1>
<p>Full API documentation is available online <b><a href="https://jsulmont.github.io/spark-plug_cpp/html/">here</a></b></p>
<p>The documentation includes complete API reference, examples, and class diagrams.</p>
<p>To regenerate locally: </p><div class="fragment"><div class="line">cmake --build build --target docs</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md3"></a>
What is Sparkplug B?</h1>
<p>Sparkplug B is an MQTT-based protocol specification for Industrial IoT that provides:</p>
<ul>
<li>Standardized MQTT topic namespace and payload definition</li>
<li>Birth and Death certificates for edge nodes and devices</li>
<li>Report by Exception for efficient bandwidth usage</li>
<li>Automatic state management and session awareness</li>
</ul>
<p>Learn more: <a href="https://www.eclipse.org/tahu/spec/Sparkplug%20Topic%20Namespace%20and%20State%20ManagementV2.2-with%20appendix%20B%20format%20-%20Eclipse.pdf">Eclipse Sparkplug Specification</a></p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md4"></a>
Quick Start</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md5"></a>
Prerequisites</h2>
<ul>
<li>C++23 compatible compiler (Clang 16+ or GCC 13+)</li>
<li>CMake 3.25+</li>
<li>Eclipse Paho MQTT C library</li>
<li>Protocol Buffers (protobuf)</li>
<li>Abseil C++ library</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md6"></a>
Installation</h2>
<p><b>macOS (Homebrew):</b></p>
<div class="fragment"><div class="line"># Install dependencies</div>
<div class="line">brew install cmake llvm protobuf abseil mosquitto libpaho-mqtt</div>
<div class="line"> </div>
<div class="line"># Clone and build</div>
<div class="line">git clone &lt;repository-url&gt;</div>
<div class="line">cd sparkplug_cpp</div>
<div class="line">cmake --preset default</div>
<div class="line">cmake --build build</div>
</div><!-- fragment --><p><b>Linux (Arch Linux - Recommended):</b></p>
<div class="fragment"><div class="line"># Install system dependencies</div>
<div class="line">sudo pacman -S \</div>
<div class="line">    base-devel clang cmake ninja \</div>
<div class="line">    protobuf abseil-cpp openssl mosquitto</div>
<div class="line"> </div>
<div class="line"># Build and install Paho MQTT C (not in official repos)</div>
<div class="line">git clone --depth 1 --branch v1.3.15 https://github.com/eclipse/paho.mqtt.c.git</div>
<div class="line">cd paho.mqtt.c</div>
<div class="line">cmake -Bbuild -H. \</div>
<div class="line">  -DCMAKE_BUILD_TYPE=Release \</div>
<div class="line">  -DPAHO_WITH_SSL=TRUE \</div>
<div class="line">  -DCMAKE_POLICY_VERSION_MINIMUM=3.5</div>
<div class="line">cmake --build build -j$(nproc)</div>
<div class="line">sudo cmake --install build</div>
<div class="line">cd ..</div>
<div class="line"> </div>
<div class="line"># Clone and build sparkplug_cpp</div>
<div class="line">git clone &lt;repository-url&gt;</div>
<div class="line">cd sparkplug_cpp</div>
<div class="line">cmake --preset default</div>
<div class="line">cmake --build build -j$(nproc)</div>
</div><!-- fragment --><p><b>Linux (Ubuntu/Debian):</b></p>
<p><b>Not currently supported</b> - Ubuntu 24.04's standard library lacks required C++23 features (<span class="tt">std::ranges::to</span>). Use Arch Linux instead.</p>
<p><b>Note:</b> This project requires full C++23 support including <span class="tt">std::expected</span> and <span class="tt">std::ranges::to</span>. Arch Linux with libc++ provides complete implementations.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md7"></a>
Basic Publisher Example</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;sparkplug/publisher.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sparkplug/payload_builder.hpp&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">  <span class="comment">// Configure publisher</span></div>
<div class="line">  <a class="code hl_struct" href="structsparkplug_1_1Publisher_1_1Config.html">sparkplug::Publisher::Config</a> config{</div>
<div class="line">    .broker_url = <span class="stringliteral">&quot;tcp://localhost:1883&quot;</span>,</div>
<div class="line">    .client_id = <span class="stringliteral">&quot;my_edge_node&quot;</span>,</div>
<div class="line">    .group_id = <span class="stringliteral">&quot;MyGroup&quot;</span>,</div>
<div class="line">    .edge_node_id = <span class="stringliteral">&quot;Edge01&quot;</span></div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_class" href="classsparkplug_1_1Publisher.html">sparkplug::Publisher</a> publisher(std::move(config));</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Connect to broker</span></div>
<div class="line">  <span class="keywordflow">if</span> (<span class="keyword">auto</span> result = publisher.connect(); !result) {</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;Failed to connect: &quot;</span> &lt;&lt; result.error() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Publish NBIRTH (required first message)</span></div>
<div class="line">  <a class="code hl_class" href="classsparkplug_1_1PayloadBuilder.html">sparkplug::PayloadBuilder</a> birth;</div>
<div class="line">  birth.<a class="code hl_function" href="classsparkplug_1_1PayloadBuilder.html#a676ca0d9675d16485b7bbd4f5dbfffa7">add_metric_with_alias</a>(<span class="stringliteral">&quot;Temperature&quot;</span>, 1, 20.5);</div>
<div class="line">  birth.<a class="code hl_function" href="classsparkplug_1_1PayloadBuilder.html#a676ca0d9675d16485b7bbd4f5dbfffa7">add_metric_with_alias</a>(<span class="stringliteral">&quot;Pressure&quot;</span>, 2, 101.3);</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">if</span> (<span class="keyword">auto</span> result = publisher.publish_birth(birth); !result) {</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;Failed to publish birth: &quot;</span> &lt;&lt; result.error() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Publish NDATA (subsequent updates)</span></div>
<div class="line">  <a class="code hl_class" href="classsparkplug_1_1PayloadBuilder.html">sparkplug::PayloadBuilder</a> data;</div>
<div class="line">  data.<a class="code hl_function" href="classsparkplug_1_1PayloadBuilder.html#a0cb1f70cd4587d1da66d9ff8b3fe1581">add_metric_by_alias</a>(1, 21.0);  <span class="comment">// Temperature changed</span></div>
<div class="line">  <span class="comment">// Pressure unchanged, not included (Report by Exception)</span></div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">if</span> (<span class="keyword">auto</span> result = publisher.publish_data(data); !result) {</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;Failed to publish data: &quot;</span> &lt;&lt; result.error() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  publisher.disconnect();</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="aclasssparkplug_1_1PayloadBuilder_html"><div class="ttname"><a href="classsparkplug_1_1PayloadBuilder.html">sparkplug::PayloadBuilder</a></div><div class="ttdoc">Type-safe builder for Sparkplug B payloads with automatic type detection.</div><div class="ttdef"><b>Definition</b> <a href="payload__builder_8hpp_source.html#l00180">payload_builder.hpp:180</a></div></div>
<div class="ttc" id="aclasssparkplug_1_1PayloadBuilder_html_a0cb1f70cd4587d1da66d9ff8b3fe1581"><div class="ttname"><a href="classsparkplug_1_1PayloadBuilder.html#a0cb1f70cd4587d1da66d9ff8b3fe1581">sparkplug::PayloadBuilder::add_metric_by_alias</a></div><div class="ttdeci">PayloadBuilder &amp; add_metric_by_alias(uint64_t alias, T &amp;&amp;value)</div><div class="ttdoc">Adds a metric by alias only (for NDATA messages).</div><div class="ttdef"><b>Definition</b> <a href="payload__builder_8hpp_source.html#l00255">payload_builder.hpp:255</a></div></div>
<div class="ttc" id="aclasssparkplug_1_1PayloadBuilder_html_a676ca0d9675d16485b7bbd4f5dbfffa7"><div class="ttname"><a href="classsparkplug_1_1PayloadBuilder.html#a676ca0d9675d16485b7bbd4f5dbfffa7">sparkplug::PayloadBuilder::add_metric_with_alias</a></div><div class="ttdeci">PayloadBuilder &amp; add_metric_with_alias(std::string_view name, uint64_t alias, T &amp;&amp;value)</div><div class="ttdoc">Adds a metric with both name and alias (for NBIRTH messages).</div><div class="ttdef"><b>Definition</b> <a href="payload__builder_8hpp_source.html#l00237">payload_builder.hpp:237</a></div></div>
<div class="ttc" id="aclasssparkplug_1_1Publisher_html"><div class="ttname"><a href="classsparkplug_1_1Publisher.html">sparkplug::Publisher</a></div><div class="ttdoc">Sparkplug B edge node publisher implementing the complete message lifecycle.</div><div class="ttdef"><b>Definition</b> <a href="publisher_8hpp_source.html#l00058">publisher.hpp:58</a></div></div>
<div class="ttc" id="astructsparkplug_1_1Publisher_1_1Config_html"><div class="ttname"><a href="structsparkplug_1_1Publisher_1_1Config.html">sparkplug::Publisher::Config</a></div><div class="ttdoc">Configuration parameters for the Sparkplug B publisher.</div><div class="ttdef"><b>Definition</b> <a href="publisher_8hpp_source.html#l00063">publisher.hpp:63</a></div></div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md8"></a>
Basic Subscriber Example</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;sparkplug/subscriber.hpp&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">  <a class="code hl_struct" href="structsparkplug_1_1Subscriber_1_1Config.html">sparkplug::Subscriber::Config</a> config{</div>
<div class="line">    .broker_url = <span class="stringliteral">&quot;tcp://localhost:1883&quot;</span>,</div>
<div class="line">    .client_id = <span class="stringliteral">&quot;my_subscriber&quot;</span>,</div>
<div class="line">    .group_id = <span class="stringliteral">&quot;MyGroup&quot;</span></div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> callback = [](<span class="keyword">const</span> <a class="code hl_struct" href="structsparkplug_1_1Topic.html">sparkplug::Topic</a>&amp; topic, </div>
<div class="line">                     <span class="keyword">const</span> <span class="keyword">auto</span>&amp; payload) {</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Received: &quot;</span> &lt;&lt; topic.<a class="code hl_function" href="structsparkplug_1_1Topic.html#ab55fe0dfb34799f7083ac20da993d427">to_string</a>() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; metric : payload.metrics()) {</div>
<div class="line">      <span class="keywordflow">if</span> (metric.has_name()) {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; metric.name() &lt;&lt; <span class="stringliteral">&quot; = &quot;</span>;</div>
<div class="line">        <span class="keywordflow">if</span> (metric.datatype() == <span class="keyword">static_cast&lt;</span>uint32_t<span class="keyword">&gt;</span>(</div>
<div class="line">            sparkplug::DataType::Double)) {</div>
<div class="line">          std::cout &lt;&lt; metric.double_value() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_class" href="classsparkplug_1_1Subscriber.html">sparkplug::Subscriber</a> subscriber(std::move(config), callback);</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">if</span> (<span class="keyword">auto</span> result = subscriber.connect(); !result) {</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;Failed to connect: &quot;</span> &lt;&lt; result.error() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  subscriber.subscribe_all();</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Keep running...</span></div>
<div class="line">  std::this_thread::sleep_for(std::chrono::hours(1));</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="aclasssparkplug_1_1Subscriber_html"><div class="ttname"><a href="classsparkplug_1_1Subscriber.html">sparkplug::Subscriber</a></div><div class="ttdoc">Sparkplug B subscriber for consuming edge node messages with validation.</div><div class="ttdef"><b>Definition</b> <a href="subscriber_8hpp_source.html#l00084">subscriber.hpp:84</a></div></div>
<div class="ttc" id="astructsparkplug_1_1Subscriber_1_1Config_html"><div class="ttname"><a href="structsparkplug_1_1Subscriber_1_1Config.html">sparkplug::Subscriber::Config</a></div><div class="ttdoc">Configuration parameters for the Sparkplug B subscriber.</div><div class="ttdef"><b>Definition</b> <a href="subscriber_8hpp_source.html#l00089">subscriber.hpp:89</a></div></div>
<div class="ttc" id="astructsparkplug_1_1Topic_html"><div class="ttname"><a href="structsparkplug_1_1Topic.html">sparkplug::Topic</a></div><div class="ttdoc">Represents a parsed Sparkplug B MQTT topic.</div><div class="ttdef"><b>Definition</b> <a href="topic_8hpp_source.html#l00044">topic.hpp:44</a></div></div>
<div class="ttc" id="astructsparkplug_1_1Topic_html_ab55fe0dfb34799f7083ac20da993d427"><div class="ttname"><a href="structsparkplug_1_1Topic.html#ab55fe0dfb34799f7083ac20da993d427">sparkplug::Topic::to_string</a></div><div class="ttdeci">std::string to_string() const</div><div class="ttdoc">Converts the topic back to a string.</div></div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md9"></a>
Building</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md10"></a>
Using CMake Presets</h2>
<div class="fragment"><div class="line"># Debug build</div>
<div class="line">cmake --preset default</div>
<div class="line">cmake --build build</div>
<div class="line"> </div>
<div class="line"># Release build</div>
<div class="line">cmake --preset release</div>
<div class="line">cmake --build build-release</div>
<div class="line"> </div>
<div class="line"># Run tests</div>
<div class="line">ctest --preset default</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md11"></a>
Manual CMake</h2>
<div class="fragment"><div class="line">mkdir build &amp;&amp; cd build</div>
<div class="line">cmake .. -DCMAKE_BUILD_TYPE=Release</div>
<div class="line">make -j$(nproc)</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md12"></a>
Examples</h1>
<p>The <span class="tt">examples/</span> directory contains:</p>
<p><b>C++ Examples:</b></p>
<ul>
<li><b>publisher_example.cpp</b> - Complete publisher with birth/data/rebirth</li>
<li><b>publisher_dynamic_metrics.cpp</b> - Adding new metrics at runtime via rebirth</li>
<li><b>subscriber_example.cpp</b> - Simple subscriber</li>
<li><b>subscriber_example_debug.cpp</b> - Detailed message inspection</li>
</ul>
<p><b>C API Examples:</b></p>
<ul>
<li><b>publisher_example_c.c</b> - Publisher using C bindings</li>
<li><b>subscriber_example_c.c</b> - Subscriber using C bindings</li>
</ul>
<p>Build and run:</p>
<div class="fragment"><div class="line"># Terminal 1: Start subscriber</div>
<div class="line">./build/examples/subscriber_example_debug</div>
<div class="line"> </div>
<div class="line"># Terminal 2: Start publisher</div>
<div class="line">./build/examples/publisher_example</div>
<div class="line"> </div>
<div class="line"># Or try the dynamic metrics example</div>
<div class="line">./build/examples/publisher_dynamic_metrics</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md13"></a>
Testing</h1>
<p>Run the compliance test suite:</p>
<div class="fragment"><div class="line"># Make sure mosquitto is running</div>
<div class="line"># macOS:</div>
<div class="line">brew services start mosquitto</div>
<div class="line"># Linux:</div>
<div class="line">sudo systemctl start mosquitto</div>
<div class="line"> </div>
<div class="line"># Run tests</div>
<div class="line">ctest --test-dir build --output-on-failure</div>
</div><!-- fragment --><p>Tests verify:</p>
<ul>
<li>NBIRTH sequence number starts at 0</li>
<li>Sequence wraps at 256</li>
<li>bdSeq increments on rebirth</li>
<li>NBIRTH contains bdSeq metric</li>
<li>Alias usage in NDATA messages</li>
<li>Sequence validation</li>
<li>Automatic timestamp generation</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md14"></a>
Code Formatting</h1>
<p>This project uses <b>clang-format</b> for consistent code style. All code is automatically checked in CI.</p>
<div class="fragment"><div class="line"># Format all files</div>
<div class="line">./scripts/format.sh</div>
<div class="line"> </div>
<div class="line"># Check formatting (CI mode)</div>
<div class="line">./scripts/format.sh --check</div>
</div><!-- fragment --><p>VSCode is configured to format on save automatically. Run the format script before committing changes.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md15"></a>
Generating Documentation</h1>
<p>The API is fully documented with Doxygen comments. To generate HTML documentation:</p>
<div class="fragment"><div class="line"># Install doxygen (if not already installed)</div>
<div class="line"># macOS:</div>
<div class="line">brew install doxygen graphviz</div>
<div class="line"># Linux:</div>
<div class="line">sudo apt install doxygen graphviz</div>
<div class="line"> </div>
<div class="line"># Generate documentation</div>
<div class="line">doxygen Doxyfile</div>
<div class="line"> </div>
<div class="line"># View documentation</div>
<div class="line">open docs/html/index.html  # macOS</div>
<div class="line"># or</div>
<div class="line">xdg-open docs/html/index.html  # Linux</div>
</div><!-- fragment --><p>The generated documentation includes:</p>
<ul>
<li>Complete API reference for both C++ and C APIs</li>
<li>Class diagrams and dependency graphs</li>
<li>Code examples from headers</li>
<li>Cross-referenced source code</li>
</ul>
<p>All public APIs are documented with:</p>
<ul>
<li>Detailed parameter descriptions</li>
<li>Return value specifications</li>
<li>Usage examples</li>
<li>Notes, warnings, and see-also references</li>
</ul>
<p><b>Tip:</b> Modern IDEs (VSCode, CLion, etc.) display Doxygen documentation as hover tooltips automatically.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md16"></a>
API Documentation</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md17"></a>
Publisher</h2>
<div class="fragment"><div class="line"><span class="keyword">class </span>Publisher {</div>
<div class="line">  <span class="comment">// Connect to MQTT broker and establish session</span></div>
<div class="line">  std::expected&lt;void, std::string&gt; connect();</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Publish NBIRTH (must be first message)</span></div>
<div class="line">  std::expected&lt;void, std::string&gt; publish_birth(PayloadBuilder&amp; payload);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Publish NDATA (auto-increments sequence)</span></div>
<div class="line">  std::expected&lt;void, std::string&gt; publish_data(PayloadBuilder&amp; payload);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Graceful disconnect (sends NDEATH via MQTT Will)</span></div>
<div class="line">  std::expected&lt;void, std::string&gt; disconnect();</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Trigger rebirth (increments bdSeq)</span></div>
<div class="line">  std::expected&lt;void, std::string&gt; rebirth();</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Get current sequence/bdSeq numbers</span></div>
<div class="line">  uint64_t get_seq() <span class="keyword">const</span>;</div>
<div class="line">  uint64_t get_bd_seq() <span class="keyword">const</span>;</div>
<div class="line">};</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md18"></a>
Subscriber</h2>
<div class="fragment"><div class="line"><span class="keyword">class </span>Subscriber {</div>
<div class="line">  <span class="comment">// Connect to MQTT broker</span></div>
<div class="line">  std::expected&lt;void, std::string&gt; connect();</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Subscribe to all messages in group</span></div>
<div class="line">  std::expected&lt;void, std::string&gt; subscribe_all();</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Subscribe to specific edge node</span></div>
<div class="line">  std::expected&lt;void, std::string&gt; subscribe_node(std::string_view edge_node_id);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Get node state (for monitoring)</span></div>
<div class="line">  <span class="keyword">const</span> NodeState* get_node_state(<span class="keyword">const</span> std::string&amp; edge_node_id) <span class="keyword">const</span>;</div>
<div class="line">};</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md19"></a>
PayloadBuilder</h2>
<div class="fragment"><div class="line"><span class="keyword">class </span>PayloadBuilder {</div>
<div class="line">  <span class="comment">// Add metric by name (for BIRTH messages)</span></div>
<div class="line">  PayloadBuilder&amp; add_metric(std::string_view name, T&amp;&amp; value);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Add metric with alias (for BIRTH messages)</span></div>
<div class="line">  PayloadBuilder&amp; add_metric_with_alias(std::string_view name, </div>
<div class="line">                                         uint64_t alias, </div>
<div class="line">                                         T&amp;&amp; value);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Add metric by alias only (for DATA messages)</span></div>
<div class="line">  PayloadBuilder&amp; add_metric_by_alias(uint64_t alias, T&amp;&amp; value);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Node Control convenience methods</span></div>
<div class="line">  PayloadBuilder&amp; add_node_control_rebirth(<span class="keywordtype">bool</span> value = <span class="keyword">false</span>);</div>
<div class="line">  PayloadBuilder&amp; add_node_control_reboot(<span class="keywordtype">bool</span> value = <span class="keyword">false</span>);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Manual timestamp/sequence setting (usually automatic)</span></div>
<div class="line">  PayloadBuilder&amp; set_timestamp(uint64_t ts);</div>
<div class="line">  PayloadBuilder&amp; set_seq(uint64_t seq);</div>
<div class="line">};</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md20"></a>
C API</h1>
<p>A C API is provided via <span class="tt">sparkplug_c.h</span> for integration with C projects:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="sparkplug__c_8h.html">sparkplug/sparkplug_c.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><a class="code hl_typedef" href="sparkplug__c_8h.html#a73a47b2c51f861bd4071864b92e6e3fb">sparkplug_publisher_t</a>* pub = <a class="code hl_function" href="sparkplug__c_8h.html#aa043862535f619b12e194ff1d1ccf873">sparkplug_publisher_create</a>(</div>
<div class="line">  <span class="stringliteral">&quot;tcp://localhost:1883&quot;</span>, <span class="stringliteral">&quot;client_id&quot;</span>, <span class="stringliteral">&quot;group_id&quot;</span>, <span class="stringliteral">&quot;edge_node_id&quot;</span></div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="sparkplug__c_8h.html#ae002540e5ade3ef6d870124b06af713d">sparkplug_publisher_connect</a>(pub);</div>
<div class="line"><span class="comment">// ... use publisher</span></div>
<div class="line"><a class="code hl_function" href="sparkplug__c_8h.html#a9d7e6a80079ec9434493a7ec8deb94d9">sparkplug_publisher_destroy</a>(pub);</div>
<div class="ttc" id="asparkplug__c_8h_html"><div class="ttname"><a href="sparkplug__c_8h.html">sparkplug_c.h</a></div><div class="ttdoc">C API for Sparkplug B protocol implementation.</div></div>
<div class="ttc" id="asparkplug__c_8h_html_a73a47b2c51f861bd4071864b92e6e3fb"><div class="ttname"><a href="sparkplug__c_8h.html#a73a47b2c51f861bd4071864b92e6e3fb">sparkplug_publisher_t</a></div><div class="ttdeci">struct sparkplug_publisher sparkplug_publisher_t</div><div class="ttdoc">Opaque handle to a Sparkplug publisher.</div><div class="ttdef"><b>Definition</b> <a href="sparkplug__c_8h_source.html#l00039">sparkplug_c.h:39</a></div></div>
<div class="ttc" id="asparkplug__c_8h_html_a9d7e6a80079ec9434493a7ec8deb94d9"><div class="ttname"><a href="sparkplug__c_8h.html#a9d7e6a80079ec9434493a7ec8deb94d9">sparkplug_publisher_destroy</a></div><div class="ttdeci">void sparkplug_publisher_destroy(sparkplug_publisher_t *pub)</div><div class="ttdoc">Destroys a publisher and frees all resources.</div></div>
<div class="ttc" id="asparkplug__c_8h_html_aa043862535f619b12e194ff1d1ccf873"><div class="ttname"><a href="sparkplug__c_8h.html#aa043862535f619b12e194ff1d1ccf873">sparkplug_publisher_create</a></div><div class="ttdeci">sparkplug_publisher_t * sparkplug_publisher_create(const char *broker_url, const char *client_id, const char *group_id, const char *edge_node_id)</div><div class="ttdoc">Creates a new Sparkplug publisher.</div></div>
<div class="ttc" id="asparkplug__c_8h_html_ae002540e5ade3ef6d870124b06af713d"><div class="ttname"><a href="sparkplug__c_8h.html#ae002540e5ade3ef6d870124b06af713d">sparkplug_publisher_connect</a></div><div class="ttdeci">int sparkplug_publisher_connect(sparkplug_publisher_t *pub)</div><div class="ttdoc">Connects the publisher to the MQTT broker.</div></div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md21"></a>
Architecture</h1>
<div class="fragment"><div class="line">+---------------------------------------------+</div>
<div class="line">|  Application (Your Code)                    |</div>
<div class="line">+---------------------------------------------+</div>
<div class="line">                    |</div>
<div class="line">                    v</div>
<div class="line">+---------------------------------------------+</div>
<div class="line">|  Sparkplug B C++ Library                    |</div>
<div class="line">|  +----------------+  +------------------+   |</div>
<div class="line">|  |  Publisher     |  |  Subscriber      |   |</div>
<div class="line">|  +----------------+  +------------------+   |</div>
<div class="line">|            |                 |               |</div>
<div class="line">|            v                 v               |</div>
<div class="line">|  +-------------------------------------+     |</div>
<div class="line">|  |   PayloadBuilder / Topic            |     |</div>
<div class="line">|  +-------------------------------------+     |</div>
<div class="line">|            |                                 |</div>
<div class="line">|            v                                 |</div>
<div class="line">|  +-------------------------------------+     |</div>
<div class="line">|  |   Protocol Buffers (Sparkplug)      |     |</div>
<div class="line">|  +-------------------------------------+     |</div>
<div class="line">+---------------------------------------------+</div>
<div class="line">                    |</div>
<div class="line">                    v</div>
<div class="line">+---------------------------------------------+</div>
<div class="line">|  Eclipse Paho MQTT C                        |</div>
<div class="line">+---------------------------------------------+</div>
<div class="line">                    |</div>
<div class="line">                    v</div>
<div class="line">+---------------------------------------------+</div>
<div class="line">|  MQTT Broker (Mosquitto, HiveMQ, etc.)      |</div>
<div class="line">+---------------------------------------------+</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md22"></a>
Sparkplug B Message Flow</h1>
<div class="fragment"><div class="line">Edge Node Lifecycle:</div>
<div class="line">1. CONNECT -&gt; MQTT Broker (with NDEATH in Last Will)</div>
<div class="line">2. NBIRTH -&gt; Establish session, publish all metrics with aliases</div>
<div class="line">3. NDATA -&gt; Report changes by exception using aliases</div>
<div class="line">4. NDATA -&gt; Continue publishing updates</div>
<div class="line">5. DISCONNECT -&gt; NDEATH sent automatically via MQTT Will</div>
<div class="line"> </div>
<div class="line">Rebirth Scenario:</div>
<div class="line">1. Primary Application sends NCMD/Rebirth</div>
<div class="line">2. Edge Node increments bdSeq</div>
<div class="line">3. Edge Node publishes new NBIRTH</div>
<div class="line">4. Edge Node resets sequence to 0</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md23"></a>
Topic Namespace</h1>
<p>The library uses the Sparkplug B topic namespace:</p>
<div class="fragment"><div class="line">spBv1.0/{group_id}/{message_type}/{edge_node_id}[/{device_id}]</div>
</div><!-- fragment --><p>Examples:</p>
<ul>
<li><span class="tt">spBv1.0/Energy/NBIRTH/Gateway01</span> - Node birth</li>
<li><span class="tt">spBv1.0/Energy/NDATA/Gateway01</span> - Node data</li>
<li><span class="tt">spBv1.0/Energy/DBIRTH/Gateway01/Sensor01</span> - Device birth</li>
<li><span class="tt">STATE/my_scada_host</span> - Primary application state</li>
</ul>
<p><b>Note:</b> The topic prefix is <span class="tt">spBv1.0</span> (Sparkplug B v1.0 namespace) even for Sparkplug 2.2 compliance. This is the MQTT topic namespace, not the specification version.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md24"></a>
Performance</h1>
<ul>
<li><b>Binary Protocol</b> - Efficient protobuf encoding</li>
<li><b>Report by Exception</b> - Only send changed values</li>
<li><b>Alias Support</b> - Reduces bandwidth by 60-80%</li>
<li><b>Async I/O</b> - Non-blocking MQTT operations</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md25"></a>
Troubleshooting</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md26"></a>
Issue: Sequence validation warnings</h2>
<p>Ensure you:</p>
<ol type="1">
<li>Publish NBIRTH before any NDATA</li>
<li>Don't manually set sequence numbers</li>
<li>Check for packet loss if gaps persist</li>
</ol>
<h2 class="doxsection"><a class="anchor" id="autotoc_md27"></a>
Issue: Connection failures</h2>
<ul>
<li>Verify MQTT broker is running:<ul>
<li>macOS: <span class="tt">brew services start mosquitto</span></li>
<li>Linux: <span class="tt">sudo systemctl start mosquitto</span></li>
<li>Or run directly: <span class="tt">mosquitto -v</span></li>
</ul>
</li>
<li>Check broker URL and port (default: 1883)</li>
<li>Ensure client_id is unique</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md28"></a>
License</h1>
<p>Licensed under either of:</p>
<ul>
<li>Apache License, Version 2.0 ([LICENSE-APACHE](LICENSE-APACHE) or <a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a>)</li>
<li>MIT license ([LICENSE-MIT](LICENSE-MIT) or <a href="http://opensource.org/licenses/MIT">http://opensource.org/licenses/MIT</a>)</li>
</ul>
<p>at your option.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md29"></a>
References</h1>
<ul>
<li><a href="https://sparkplug.eclipse.org/">Eclipse Sparkplug Specification</a></li>
<li><a href="https://github.com/eclipse/tahu">Eclipse Tahu (Reference Implementation)</a></li>
<li><a href="https://mqtt.org/">MQTT Protocol</a></li>
<li><a href="https://protobuf.dev/">Protocol Buffers</a></li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md30"></a>
Roadmap</h1>
<ul>
<li>mTLS support</li>
<li>Sparkplug Templates support</li>
<li>Historical data buffering</li>
<li>Metrics dashboard example</li>
</ul>
<hr  />
<p><b>Questions?</b> See the API documentation in the header files or open an issue. </p>
</div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"></a>
</div><!-- contents -->
</div><!-- doc-content -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on <span class="timestamp"></span> for Sparkplug B C++ Library by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
