# Mosquitto Test Configuration
# Supports both plain MQTT (1883) and TLS (8883) connections
# For testing sparkplug-cpp TLS/mTLS functionality

# General settings
persistence true
persistence_location /opt/homebrew/var/mosquitto/

log_dest stdout
log_type all

# Allow anonymous connections (for testing only!)
allow_anonymous true

# =============================================================================
# Plain MQTT Listener (port 1883)
# =============================================================================
listener 1883
protocol mqtt

# =============================================================================
# TLS/SSL Listener (port 8883)
# =============================================================================
listener 8883
protocol mqtt

# Server certificate and key
certfile /Users/jan/dev/sparkplug-cpp/certs/server.crt
keyfile /Users/jan/dev/sparkplug-cpp/certs/server.key

# CA certificate (for client verification)
cafile /Users/jan/dev/sparkplug-cpp/certs/ca.crt

# Client certificate verification
# - false: TLS only (server authentication)
# - true: mTLS (mutual authentication - requires client certificates)
require_certificate false

# If you want to test mTLS, set require_certificate to true:
# require_certificate true

# TLS version - require TLS 1.2 or higher
tls_version tlsv1.2

# =============================================================================
# Additional TLS Listener for mTLS Testing (port 8884) - OPTIONAL
# =============================================================================
# Uncomment this section to have a dedicated mTLS port
#
# listener 8884
# protocol mqtt
# certfile /Users/jan/dev/sparkplug-cpp/certs/server.crt
# keyfile /Users/jan/dev/sparkplug-cpp/certs/server.key
# cafile /Users/jan/dev/sparkplug-cpp/certs/ca.crt
# require_certificate true
# tls_version tlsv1.2
