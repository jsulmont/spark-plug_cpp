# Mosquitto Test Configuration
# Supports both plain MQTT (1883) and TLS (8883) connections
# For testing sparkplug-cpp TLS/mTLS functionality

# General settings
persistence false

log_dest stdout
log_type all

# Password authentication (used by TLS listener)
# Use relative path for better portability (CI and local dev)
password_file certs/passwordfile

# =============================================================================
# Plain MQTT Listener (port 1883)
# =============================================================================
listener 1883
protocol mqtt
allow_anonymous true

# =============================================================================
# TLS/SSL Listener (port 8883) - TLS with optional password authentication
# =============================================================================
listener 8883
protocol mqtt

# Allow both anonymous and authenticated connections
# This enables testing of:
#   - TLS-only (no client certs, no password)
#   - TLS + password (no client certs, with password)
#   - TLS + mTLS (with client certs, no password)
#   - TLS + mTLS + password (with client certs and password - production config)
allow_anonymous true

# Server certificate and key (relative paths for portability)
certfile certs/server.crt
keyfile certs/server.key

# CA certificate (for client verification)
cafile certs/ca.crt

# Client certificate verification (mTLS)
# - false: TLS + password only
# - true: mTLS + password (production configuration)
require_certificate false

# TLS version - require TLS 1.2 or higher
tls_version tlsv1.2

# =============================================================================
# Additional TLS Listener for mTLS Testing (port 8884) - OPTIONAL
# =============================================================================
# Uncomment this section to have a dedicated mTLS port
#
# listener 8884
# protocol mqtt
# certfile /Users/jan/dev/sparkplug-cpp/certs/server.crt
# keyfile /Users/jan/dev/sparkplug-cpp/certs/server.key
# cafile /Users/jan/dev/sparkplug-cpp/certs/ca.crt
# require_certificate true
# tls_version tlsv1.2
